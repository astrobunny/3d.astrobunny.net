<!DOCTYPE html>
<html>
<!-- Generated using weaver: https://github.com/davidsiaw/weaver -->
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Klipper UART</title>

    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="../../css/plugins/iCheck/custom.css" rel="stylesheet">

    	<link href="../../css/style.css" rel="stylesheet">


    <link href="../../css/animate.css" rel="stylesheet">

    <link href="../../css/indigo-manual.css" rel="stylesheet">




</head>

<body class='gray-bg'>

<div id="background" style="z-index: -999; position:absolute; left:0px; right:0px; width:100%; height:100%">

</div>

<div id="content" style="z-index: 0">

        <div id="wrapper">
	        <div class="wrapper-content">
	            <div class="container">
<div class="row">  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class="row"><div class="hidden-xs hidden-sm col-md-2 col-lg-2 col-print-hidden"><div class="menu sidemenu"><div class="panel-group" id="accordion0"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion0" href="#tab7"><a href="/" class="menulink">Home</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab7" class="panel-collapse collapse in"><div class="panel-body"><ul><li ><div class="panel-group" id="accordion1"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion1" href="#tab1"><a href="/3dprint/" class="menulink">3D Printing</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab1" class="panel-collapse collapse in"><div class="panel-body"><ul><li title="This is the current page"><span id="selected">Klipper UART</span></li><a href="/3dprint/voron/"><li >Voron</li></a><li ><div class="panel-group" id="accordion2"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion2" href="#tab0" class="collapsed"><a href="/3dprint/voronmods/" class="menulink">Voron Mods</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab0" class="panel-collapse collapse"><div class="panel-body"><ul><a href="/3dprint/voronmods/micronjigs/"><li >Micron Jigs</li></a><a href="/3dprint/voronmods/micronmask/"><li >Dragonburner Logo Mask</li></a><li ></li></ul></div></div></div></div></li></ul></div></div></div></div><div class="panel-group" id="accordion3"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion3" href="#tab3" class="collapsed"><a href="/elec/" class="menulink">Electronics</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab3" class="panel-collapse collapse"><div class="panel-body"><ul><li ><div class="panel-group" id="accordion4"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion4" href="#tab2" class="collapsed"><a href="/elec/notes/" class="menulink">Notes</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab2" class="panel-collapse collapse"><div class="panel-body"><ul><a href="/elec/notes/protoboard/"><li >Protoboard</li></a><a href="/elec/notes/rpi-tft/"><li >RPI TFT</li></a><a href="/elec/notes/rpiusbether/"><li >RPI USB Ether</li></a><li ></li></ul></div></div></div></div></li></ul></div></div></div></div><div class="panel-group" id="accordion5"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion5" href="#tab5" class="collapsed"><a href="/hardware/" class="menulink">Hardware</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab5" class="panel-collapse collapse"><div class="panel-body"><ul><li ><div class="panel-group" id="accordion6"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion6" href="#tab4" class="collapsed"><a href="/hardware/notes/" class="menulink">Notes</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab4" class="panel-collapse collapse"><div class="panel-body"><ul><a href="/hardware/notes/motorshaft/"><li >Motor Shaft</li></a><li ></li></ul></div></div></div></div></li></ul></div></div></div></div><div class="panel-group" id="accordion7"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion7" href="#tab6" class="collapsed"><a href="/tables/" class="menulink">Tables</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab6" class="panel-collapse collapse"><div class="panel-body"><ul><a href="/tables/constants/"><li >Constants</li></a><a href="/tables/units/"><li >Units</li></a><li ></li></ul></div></div></div></div></li></ul></div></div></div></div></div></div><div class="col-xs-12 col-sm-12 col-md-10 col-lg-10 col-print-12"><div class="row">  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""></div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""><h1><pi  /><span>Klipper UART</span></h1></div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""><div><div>These are some notes on setting up Klipper on your Raspberry Pi to talk to your MCU, whether it be a Manta or SKR or whatever over UART rather than USB. This can be useful when you are using something like a Raspberry Pi Zero that only has one USB port for data that you would like to reserve for debugging.</div></div></div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""><h2><pi  /><span>Physical Wiring</span></h2></div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""><div><div>Refer to the image below:</div></div><div class="nicedoc-figureholder"><img src="/images/klipperuart/kuartconnection.webp" class="img-responsive nicedoc-figure" alt="Wiring" /></div><div><div>In this image I used a green blue and black wire to do this between a Raspberry Pi Zero and an SKR 1.4. The wires are:</div></div><ul><li><div>Black for Ground</div></li><li><div>Green for RX on the SKR 1.4 and TX on the Raspberry Pi</div></li><li><div>Blue for TX on the SKR 1.4 and RX on the Raspberry Pi</div></li></ul><br  /><div><div>I used the pins labelled TFT in the <a href="https://github.com/bigtreetech/BIGTREETECH-SKR-V1.3/blob/master/BTT%20SKR%20V1.4/Hardware/BTT%20SKR%20V1.4PIN.pdf">SKR 1.4 Pin diagram</a> for this purpose since they were available to be programmed that way.</div></div><br  /><div class="nicedoc-figureholder"><img src="/images/klipperuart/skr.webp" class="img-responsive nicedoc-figure" alt="SKR 1.4 excerpt" /></div><div><div>The ground pin I simply connect to the GND pin on the Pi Zero closest to where the TX and RX pins are located.</div></div><div><div>I also check the <a href="https://github.com/bigtreetech/BIGTREETECH-SKR-V1.3/blob/master/BTT%20SKR%20V1.4/Hardware/BTT%20SKR%20V1.4-SCH.pdf">schematic</a> to know what the pin names are for those, and it seems like they are <span class="span-code">P0.3</span> and <span class="span-code">P0.2</span>. This will be needed when configuring Klipper.</div></div><br  /><div class="nicedoc-figureholder"><img src="/images/klipperuart/pinnums.png" class="img-responsive nicedoc-figure" alt="Schematic Excerpt." /></div></div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""><h2><pi  /><span>Pi Software</span></h2></div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""><div><div>Now that the pins have been connected a few things have to be done to get this working. Firstly the Pi Zero needs to be configured to communicated using UART. Since these pins are already designated as the UART pins you do not need to designate them in any special way.</div></div><br  /><div><div>You need to modify the <span class="span-code">config.txt</span> file and add to the very bottom, or after the <span class="span-code">[all</span>` section:</div></div><br  /><pre class="highlight">[all]
dtoverlay=pi3-miniuart-bt
enable_uart=1</pre><p><span>Make sure to check that these things, <span class="span-code">pi3-miniuart-bt</span> and <span class="span-code">enable_uart=1</span> are not written anywhere else further up in this file, because you might already be using them for something else. But if you know those pins were never used then you can safely delete those lines containing them.</span></p><p><span>Open your <span class="span-code">cmdline.txt</span> to make sure that you aren't using those pins to connect to the console too. There might be a <span class="span-code">console=serial0,115200</span> in there if you are, in which case you might want to do something else for console and delete that from it.</span></p><p><span>Otherwise, that is all you have to do to enable UART on your Pi. Just reboot your Pi and run <span class="span-code">ls /dev/ttyS0</span> and <span class="span-code">ls /dev/ttyAMA0</span> to check if you have one or the other present. Both files might be present too, but that is okay. This file is created by the driver for communicating over UART, and Klipper will use it</span></p></div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""><h2><pi  /><span>MCU Firmware</span></h2></div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""><p><span>Next, you will need to go into the Klipper directory, which usually involves <span class="span-code">cd Klipper</span> and run</span></p><pre class="highlight">make menuconfig</pre><p><span>In my case like I did in the picture above, the SKR 1.4 I connected the pins to <span class="span-code">P0.3</span> and <span class="span-code">P0.2</span> so I need to configure them as such:</span></p><div class="nicedoc-figureholder"><img src="/images/klipperuart/menuconfig1.webp" class="img-responsive nicedoc-figure" alt="Screenshot from Menuconfig" /></div><br  /><p><span>And then I go through the process of flashing my SKR 1.4 by <span class="span-code">make</span> and then copying the <span class="span-code">klipper.bin</span> to an SD card and inserting that SD card into my SKR 1.4.</span></p></div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""><h2><pi  /><span>Klipper configuration</span></h2></div>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class=""><div><div>Finally we can go into mainsail or anything you use to edit the <span class="span-code">printer.cfg</span> to enable it. You might need to experiment if your Pi had both <span class="span-code">/dev/ttyS0</span> or <span class="span-code">/dev/ttyAMA0</span> when checking above. Make sure you also have the <span class="span-code">restart: command</span> line when you use this method since there needs to be a way for Klipper to request that your MCU restart itself, and this method would not work without it.</div></div><br  /><pre class="highlight"><span class="pi">[</span><span class="nv">mcu</span><span class="pi">]</span>
<span class="na">serial</span><span class="pi">:</span> <span class="s">/dev/ttyS0</span> <span class="c1"># or /dev/ttyAMA0</span>
<span class="na">restart</span><span class="pi">:</span> <span class="s">command</span></pre></div>
  </div>
</div></div></div><div class="col-xs-12 col-sm-12 hidden-md hidden-lg col-print-hidden"><div class="menu mobilemenu"><div class="panel-group" id="accordion8"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion8" href="#tab15"><a href="/" class="menulink">Home</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab15" class="panel-collapse collapse in"><div class="panel-body"><ul><li ><div class="panel-group" id="accordion9"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion9" href="#tab9"><a href="/3dprint/" class="menulink">3D Printing</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab9" class="panel-collapse collapse in"><div class="panel-body"><ul><li title="This is the current page"><span id="selected">Klipper UART</span></li><a href="/3dprint/voron/"><li >Voron</li></a><li ><div class="panel-group" id="accordion10"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion10" href="#tab8" class="collapsed"><a href="/3dprint/voronmods/" class="menulink">Voron Mods</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab8" class="panel-collapse collapse"><div class="panel-body"><ul><a href="/3dprint/voronmods/micronjigs/"><li >Micron Jigs</li></a><a href="/3dprint/voronmods/micronmask/"><li >Dragonburner Logo Mask</li></a><li ></li></ul></div></div></div></div></li></ul></div></div></div></div><div class="panel-group" id="accordion11"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion11" href="#tab11" class="collapsed"><a href="/elec/" class="menulink">Electronics</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab11" class="panel-collapse collapse"><div class="panel-body"><ul><li ><div class="panel-group" id="accordion12"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion12" href="#tab10" class="collapsed"><a href="/elec/notes/" class="menulink">Notes</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab10" class="panel-collapse collapse"><div class="panel-body"><ul><a href="/elec/notes/protoboard/"><li >Protoboard</li></a><a href="/elec/notes/rpi-tft/"><li >RPI TFT</li></a><a href="/elec/notes/rpiusbether/"><li >RPI USB Ether</li></a><li ></li></ul></div></div></div></div></li></ul></div></div></div></div><div class="panel-group" id="accordion13"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion13" href="#tab13" class="collapsed"><a href="/hardware/" class="menulink">Hardware</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab13" class="panel-collapse collapse"><div class="panel-body"><ul><li ><div class="panel-group" id="accordion14"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion14" href="#tab12" class="collapsed"><a href="/hardware/notes/" class="menulink">Notes</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab12" class="panel-collapse collapse"><div class="panel-body"><ul><a href="/hardware/notes/motorshaft/"><li >Motor Shaft</li></a><li ></li></ul></div></div></div></div></li></ul></div></div></div></div><div class="panel-group" id="accordion15"><div class="panel panel-default"><div class="panel-heading"><h5><div class="panel-title"><a data-toggle="collapse" data-parent="#accordion15" href="#tab14" class="collapsed"><a href="/tables/" class="menulink">Tables</a></a></div></h5><div class="ibox-tools"></div></div><div id="tab14" class="panel-collapse collapse"><div class="panel-body"><ul><a href="/tables/constants/"><li >Constants</li></a><a href="/tables/units/"><li >Units</li></a><li ></li></ul></div></div></div></div></li></ul></div></div></div></div></div></div>
  </div>
</div>
	            </div>
			</div>
		</div>

</div>

    <!-- Mainly scripts -->
    <script src="../../js/jquery-3.1.1.min.js"></script>
    <script src="../../js/jquery-ui-1.10.4.min.js"></script>
    <script src="../../js/bootstrap.min.js"></script>
    <script src="../../js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="../../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			asciimath2jax: {
				delimiters: [['$$$MATH$$$','$$$ENDMATH$$$']]
			}
		});
	</script>
    <script src="../../js/MathJax/MathJax.js?config=AM_HTMLorMML-full" async></script>




    <!-- Custom and plugin javascript -->
    <script src="../../js/weaver.js"></script>
    

    <script>



$( document ).ready(function() {



});
    </script>



</body>

</html>

